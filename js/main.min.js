"use strict";function initMap(){var mapOptions=[{featureType:"landscape",stylers:[{hue:"#FFBB00"},{saturation:43.400000000000006},{lightness:37.599999999999994},{gamma:1}]},{featureType:"road.highway",stylers:[{hue:"#FFC200"},{saturation:-61.8},{lightness:45.599999999999994},{gamma:1}]},{featureType:"road.arterial",stylers:[{hue:"#FF0300"},{saturation:-100},{lightness:51.19999999999999},{gamma:1}]},{featureType:"road.local",stylers:[{hue:"#FF0300"},{saturation:-100},{lightness:52},{gamma:1}]},{featureType:"water",stylers:[{hue:"#0078FF"},{saturation:-13.200000000000003},{lightness:2.4000000000000057},{gamma:1}]},{featureType:"poi",stylers:[{hue:"#00FF6A"},{saturation:-1.0989010989011234},{lightness:11.200000000000017},{gamma:1}]}];map=new google.maps.Map(document.getElementById("map"),{center:{lat:51.3517278,lng:-2.9497165},scrollwheel:!1,zoom:12,styles:mapOptions}),ko.applyBindings(new KoViewModel)}function googleError(){alert("Error: Your Google Map has failed to load")}var places=[{id:"1",name:"Brit Bar",address:"118 High St, Weston-super-Mare",lat:51.35045615524592,lng:-2.9788606936460815,info:"Amazing beer, some of which is brewed in the pub!",tags:["bars","pubs","nightlife"]},{id:"2",name:"The Imperial Brasserie",address:"14 S Parade, Weston-super-Mare",lat:51.35009059655817,lng:-2.9801435218494827,info:"Popular pub and restaurant with live music",tags:["bars","pubs","restaurant"]},{id:"3",name:"Yates's",address:"12-20 Regent St, Weston-super-Mare",lat:51.347643,lng:-2.979869842529297,info:"Lively chain venue with typical English decor, a menu of pub classics and regular promotions",tags:["bars","pub","restaurant","nightlife"]},{id:"4",name:"Cabot Court Hotel",address:"1 Knightstone Rd, Weston-super-Mare",lat:51.35040093628007,lng:-2.9824093625121386,info:"Down-to-earth rooms in a Regency property with original period features and free Wi-Fi",tags:["hotel","bars","pubs","restaurant","nightlife"]},{id:"5",name:"Tavern Inn The Town",address:"57-59 Regent St, Weston-super-Mare",lat:51.34748360652798,lng:-2.9772897607097013,info:"Pub",tags:["pubs","bars"]},{id:"6",name:"Grand Pier",address:"Marine Parade, Weston-super-Mare",lat:51.3477831763546,lng:-2.9860496520996094,info:"Seaside pier with land train, indoor rides, arcade machines plus candy floss, ice cream and tearoom.",tags:["attractions","pier","family"]},{id:"7",name:"SeaQuarium",address:"7 Marine Parade, Weston-super-Mare",lat:51.342676890571425,lng:-2.981543956657001,info:"Aquarium on its own pier, with a touch pool and species including jellyfish, piranhas, puffer fish.",tags:["aquarium","attractions","family"]},{id:"8",name:"Puxton Park",address:"Cowslip Ln, Hewish",lat:51.36167545078643,lng:-2.8707474652563634,info:"All-weather adventure park with soft play, aerial climbing and slides in 40 acres of countryside. ",tags:["farm","attractions","family","adventure"]},{id:"9",name:"Weston-Super-Mare Railway Station (WSM)",address:"Station Approach, Weston-super-Mare",lat:51.34432029845645,lng:-2.971680685877802,info:"Railway Station",tags:["trains","stations","railway"]},{id:"10",name:"Weston Milton Railway Station (WNM)",address:"Saville Rd., Weston-super-Mare",lat:51.34847052431751,lng:-2.9424023628234885,info:"Weston Milton railway station serves the Milton and Locking Castle areas of Weston-super-Mare in North Somerset, England.",tags:["trains","stations","railway"]},{id:"11",name:"Worle Railway Station (WOR)",address:"Park Way, Weston-super-Mare",lat:51.35794719120777,lng:-2.909366341787722,info:"Worle railway station, on the Bristol to Exeter Line, serves the Worle, West Wick and St Georges suburbs of Weston-super-Mare in North Somerset, England.",tags:["trains","stations","railway"]}],map,KoViewModel=function(){var self=this;self.click=function(){$("html, body").animate({scrollTop:$("#list-view").offset().top},"slow")};var Place=function(place){this.id=place.id,this.name=place.name,this.address=place.address,this.lat=place.lat,this.lng=place.lng,this.tags=place.tags,this.info=place.info,this.latLng={lat:place.lat,lng:place.lng}},infowindow=new google.maps.InfoWindow;self.activeClick=ko.observable(),self.collapsed=ko.observable(!1),self.venueUrl=ko.observable(),self.venuePhone=ko.observable(),self.infoArray=ko.observableArray(),self.infoError=ko.observable(!1),self.ajaxError=ko.observable(!1),self.visiblePhotos=ko.observableArray(),self.flickrImg=ko.observable(),self.ownerId=ko.observable(),self.allPlaces=ko.observableArray(),places.forEach(function(place){self.allPlaces().push(new Place(place))}),self.allPlaces().forEach(function(place){var markerOptions={position:place.latLng,map:map,animation:google.maps.Animation.DROP};place.marker=new google.maps.Marker(markerOptions),place.marker.addListener("click",function(){infowindow.open(map,place.marker),place.marker.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){place.marker.setAnimation(null)},1450),self.listClick(place),self.infoRequest(place),self.photoRequest(place)})}),self.visiblePlaces=ko.observableArray(),self.allPlaces().forEach(function(place){self.visiblePlaces.push(place)}),self.userInput=ko.observable("");var filterNames=[];self.allPlaces().forEach(function(place){filterNames.push(place.name)}),$(function(){$("#filter").autocomplete({source:filterNames,autoFocus:!0,select:function(e,ui){self.userInput(ui.item.value)}})}),self.filteredList=ko.computed(function(){if(self.userInput())var searchInput=self.userInput().toLowerCase();return self.userInput()?ko.utils.arrayFilter(self.visiblePlaces(),function(place){return place.marker.setVisible(!1),infowindow.close(),self.collapsed(!1),self.activeClick(!1),self.toggle(),-1!==place.name.toLowerCase().indexOf(searchInput)||-1!==place.tags.indexOf(searchInput)?(place.marker.setVisible(!0),place.name):void 0}):ko.utils.arrayFilter(self.allPlaces(),function(place){return place.marker.setVisible(!0),place.name})},self),self.toggle=function(id){infowindow.close(),self.collapsed(!1);var el=document.getElementById(id),elementList=document.querySelectorAll("li");elementList.forEach(function(element){element.classList.remove("active")}),el&&el.classList.add("active")},self.markerTrigger=function(data){google.maps.event.trigger(data.marker,"click")},self.listClick=function(data){self.activeClick(data.id),data.collapsed=ko.computed(function(){return self.collapsed(!1)?"collapse in"+self.activeClick():"collapsed"+self.activeClick()},self),self.collapsed(data.collapsed())},self.infoRequest=function(place){self.ajaxError(!1),self.infoError(!1),self.venueUrl(null),self.venuePhone(null),self.infoArray(null);var venue=ko.observable();place.url=ko.observable(place.url),place.phone=ko.observable(place.phone);var infoArray=[],foursquareUrl="https://api.foursquare.com/v2/venues/search?ll="+place.lat+","+place.lng+"&intent=match&name="+place.name+"&client_id=OXYOWWZSQILOKF21ZNLDZ0050FIJMRRBG0RPKSH2ZEEVUDEV&client_secret=UNWECJ2HMPBYHOWT4ZK0MK4ZDOFE5CRQYQIT514ZNU3V2DCP&v=20160519";$.getJSON(foursquareUrl,function(data){venue=data.response.venues[0],void 0!==venue&&venue.hasOwnProperty("url")&&(self.venueUrl('<a href="'+venue.url+'">'+venue.url+"</a>"),infoArray.push('<h6>Contact:</h6><a href="'+venue.url+'">'+venue.url+"</a><br>")),void 0!==venue&&venue.hasOwnProperty("contact")&&venue.contact.hasOwnProperty("formattedPhone")&&(self.venuePhone(venue.contact.formattedPhone),infoArray.push(venue.contact.formattedPhone+"<br>")),void 0===infoArray[0]?(self.infoArray("<h5>"+place.name+"</h5><br><h6>Address: </h6>"+place.address+'<br><p class="info-error"><br>Phone and Website information currently unavailable.</p>'),self.infoError(!0)):self.infoArray("<h5>"+place.name+"</h5><br>"+infoArray.join("")+'<p class="info-error"><em>provided by Foursquare</em></p><h6>Address: </h6>'+place.address)}).fail(function(){self.ajaxError(!0),self.infoArray("<h5>"+place.name+"</h5><br><h6>Address: </h6>"+place.address+'<br><p class="info-error"><br>Phone and Website information currently unavailable.</p>')})},self.photoRequest=function(place){place.apiTimeout=setTimeout(function(){self.ajaxError(!0)},5e3),self.ajaxError(!1),self.visiblePhotos(null);var photoArray=[],flickrKey="153430b4e3a967170f237d09583ee9f1",placeName=place.name,flickrAPI="https://api.flickr.com/services/rest/?method=flickr.photos.search";$.getJSON(flickrAPI,{api_key:flickrKey,extras:"geo",has_geo:1,per_page:3,tags:placeName,tagmode:"all",format:"json",nojsoncallback:1}).done(function(data){if("0"!=data.photos.total){clearTimeout(place.apiTimeout);var allPhotos=data.photos.photo;allPhotos.forEach(function(photo){self.flickrImg('src="http://farm'+photo.farm+".static.flickr.com/"+photo.server+"/"+photo.id+"_"+photo.secret+'_z.jpg">'),photoArray.push("<img "+self.flickrImg()),self.ownerId('<br><em><p class="info-error">flickr photo from <a  href="http://www.flickr.com/photos/'+photo.owner+'">flickr.com/photos/'+photo.owner+"</a></p></em>"),photoArray.push(self.ownerId()),self.visiblePhotos(photoArray.join(""))}),infowindow.setContent(self.infoArray()+'<br><br><img class="window-img" '+photoArray[0]+photoArray[1])}else infowindow.setContent(self.infoArray()+'<p class="info-error">No photos found for this location.</p>'),clearTimeout(place.apiTimeout),self.ajaxError(!0)}).fail(function(){self.ajaxError(!0),infowindow.setContent(self.infoArray()+'<p class="info-error">No photos found for this location.</p>')})}};